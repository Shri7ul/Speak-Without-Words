<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Speak Without Words</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 16px;
        background: #fafafa;
      }

      .wrap {
        display: flex;
        gap: 16px;
        align-items: flex-start;
        flex-wrap: wrap;
      }

      .card {
        padding: 14px;
        border: 1px solid #ddd;
        border-radius: 16px;
        background: white;
      }

      img {
        width: 640px;
        height: 480px;
        border-radius: 16px;
        border: 1px solid #ccc;
      }

      .badge {
        font-size: 24px;
        font-weight: 800;
        padding: 12px 18px;
        border-radius: 999px;
        display: inline-block;
        color: #000 !important;
        min-width: 180px;
        text-align: center;
      }

      .meta {
        margin-top: 10px;
        color: #333;
        font-size: 14px;
      }

      /* moods */
      .neutral { background: #eaeaea; }
      .alert   { background: #ffcccc; }
      .calm    { background: #dde9ff; }
      .focus   { background: #eee3ff; }

      /* pulse animation for STOP / HELP */
      .alert {
        animation: pulse 0.9s infinite;
      }

      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }

      /* debug box */
      #raw {
        margin-top: 10px;
        font-size: 12px;
        color: #666;
        word-break: break-all;
      }
    </style>
  </head>

  <body>
    <h2>Speak Without Words (Live)</h2>

    <div class="wrap">
      <div class="card">
        <img src="/video_feed" alt="camera stream" />
      </div>

      <div class="card" style="min-width: 300px;">
        <div id="badge" class="badge neutral">â€¦</div>
        <div class="meta" id="meta">Confidence: 0.00</div>
        <div id="raw"></div>

        <p style="margin-top:14px; line-height:1.5;">
          Try:
          <br>â›” Open palm = STOP
          <br>âœ‹ Fist = WAIT
          <br>ðŸ’™ Peace = CALM
          <br>ðŸš¨ Open palm high = HELP
        </p>
      </div>
    </div>

    <script>
      let lastGesture = "NONE";

      // ðŸ”Š Optional sound (future use)
      // To enable:
      // 1) Put beep.mp3 inside /static folder
      // 2) Uncomment the next line
       const beep = new Audio("/static/beep.mp3");

      async function tick(){
        try{
          const res = await fetch("/predict?_=" + Date.now());
          const data = await res.json();

          const badge = document.getElementById("badge");

          // fallback chain: icon â†’ text â†’ label â†’ gesture
          const icon = data.icon || "";
          const text = data.text || data.label || data.gesture || "â€¦";

          badge.innerText = icon ? (icon + " " + text) : text;
          badge.className = "badge " + (data.mood || "neutral");

          document.getElementById("meta").innerText =
            "Confidence: " + (data.confidence ?? 0).toFixed(2) +
            " | Gesture: " + (data.gesture || "NONE");

          // Debug raw JSON (remove before final submission)
          const raw = document.getElementById("raw");
          if (raw) raw.innerText = "RAW: " + JSON.stringify(data);

          // ðŸš¨ HELP visual + sound trigger (sound optional)
          if (data.gesture === "HELP" && lastGesture !== "HELP") {
            document.body.style.background = "#ffe6e6";
            setTimeout(() => {
              document.body.style.background = "#fafafa";
            }, 300);

            // ðŸ”” Uncomment if you add beep.mp3
             beep.play();
          }

          lastGesture = data.gesture;

        } catch(err){
          console.log(err);
        }
      }

      setInterval(tick, 200);
      tick();
    </script>

  </body>
</html>
